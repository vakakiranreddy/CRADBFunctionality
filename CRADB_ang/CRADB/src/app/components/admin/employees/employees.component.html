<div class="container-fluid">
  <div class="admin-header">
    <div class="header-left">
      <h2 class="page-title">Employee Management</h2>
      <p class="page-subtitle">Manage employee data and information.</p>
    </div>
    <div class="profile-section">
      <div class="profile-trigger" (click)="toggleProfileDropdown()">
        <div class="profile-avatar">
          <span>{{ getUserInitials() }}</span>
        </div>
        <span class="profile-name">{{ getUserRole() }}</span>
        <i class="fas fa-chevron-down"></i>
      </div>

      @if (showProfileDropdown) {
      <div class="profile-dropdown">
        <a class="dropdown-item" routerLink="/profile">
          <i class="fas fa-user"></i>Profile
        </a>
        <div class="dropdown-divider"></div>
        <a class="dropdown-item" (click)="logout()">
          <i class="fas fa-sign-out-alt"></i>Logout
        </a>
      </div>
      }
    </div>
  </div>

  <div class="actions-bar">
    <div class="actions-left">
      <h4 class="resource-count">Founding <span class="count-badge">{{filteredEmployees.length}} Members</span></h4>
    </div>
    <div class="actions-right">
      <button class="btn-filter" (click)="toggleFilters()">
        <i class="fas fa-filter"></i>Filter
      </button>
      <button class="btn-add" (click)="showAddEmployeeModal = true">
        <i class="fas fa-plus"></i>Add Employee
      </button>
    </div>
  </div>

  <div class="content-section">
    <!-- Filters Section -->
    <div *ngIf="showFilters" class="filters-panel">
      <div class="filter-row">
        <select class="filter-select" [(ngModel)]="selectedDepartment" (change)="applyFilters()">
          <option value="">All Departments</option>
          <option *ngFor="let dept of departments" [value]="dept.DepartmentId">{{dept.DepartmentName}}</option>
        </select>
        <select class="filter-select" [(ngModel)]="selectedLocation" (change)="applyFilters()">
          <option value="">All Locations</option>
          <option *ngFor="let loc of locations" [value]="loc.LocationId">{{loc.Name}}</option>
        </select>
        <select class="filter-select" [(ngModel)]="selectedStatus" (change)="applyFilters()">
          <option value="">All Status</option>
          <option value="true">Active</option>
          <option value="false">Inactive</option>
        </select>
      </div>
    </div>

    <div class="search-section">
      <div class="search-box">
        <i class="fas fa-search search-icon"></i>
        <input type="text" class="search-input" placeholder="Search employees..." [(ngModel)]="searchTerm"
          (input)="searchEmployees()">
      </div>
    </div>

    <div *ngIf="loading" class="loading-state">
      <div class="spinner-border"></div>
      <p>Loading employees...</p>
    </div>

    <div *ngIf="!loading && paginatedEmployees && paginatedEmployees.length > 0" class="employees-grid">
      <div *ngFor="let employee of paginatedEmployees; trackBy: trackByEmployeeId" class="employee-card">
        <div *ngIf="employee">
          <div class="employee-header">
            <div class="status-badge" [class]="employee.IsActive ? 'status-in' : 'status-out'">
              {{employee.IsActive ? 'Active' : 'Inactive'}}
            </div>
            <div class="employee-avatar">
              <div class="avatar-placeholder">
                {{ getEmployeeInitials(employee) }}
              </div>
            </div>
          </div>

          <div class="employee-content">
            <div class="employee-info">
              <h6 class="employee-id">{{ employee.EmployeeId }} - {{ employee.FirstName }} {{ employee.LastName }}</h6>
              <p class="employee-role">{{ employee.Title || employee.Role }}</p>

              <div class="contact-info">
                <div class="contact-item">
                  <i class="fas fa-envelope"></i>
                  <span>{{ employee.Email }}</span>
                </div>
                <div class="contact-item">
                  <i class="fas fa-phone"></i>
                  <span>{{ employee.PhoneNumber || 'N/A' }}</span>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div *ngIf="!loading && filteredEmployees.length === 0 && searchTerm" class="empty-state">
      <i class="fas fa-search"></i>
      <h5>No employees found</h5>
      <p>Try adjusting your search criteria</p>
    </div>

    <div *ngIf="!loading && employees.length === 0" class="empty-state">
      <i class="fas fa-users"></i>
      <h5>No employees yet</h5>
      <p>Start by adding your first employee</p>
      <button class="btn-primary" routerLink="/admin/user-management">
        <i class="fas fa-plus"></i>Add Employee
      </button>
    </div>

    <div class="pagination-section">
      <div class="pagination-info">
        <span>View</span>
        <select class="page-size-select" [(ngModel)]="pageSize" (change)="updatePageSize()">
          <option value="8">8</option>
          <option value="16">16</option>
          <option value="24">24</option>
        </select>
        <span>Employees per page</span>
      </div>

      <div class="pagination-results">
        <span>Showing {{getDisplayedCount()}}/{{employees.length}} results</span>
      </div>

      <div class="pagination-controls">
        <button class="page-btn" [disabled]="currentPage === 1" (click)="previousPage()">
          <i class="fas fa-chevron-left"></i>
        </button>
        <button *ngFor="let page of getPageNumbers()" class="page-btn" [class.active]="page === currentPage"
          (click)="goToPage(page)">
          {{page}}
        </button>
        <button class="page-btn" [disabled]="currentPage === getTotalPages()" (click)="nextPage()">
          <i class="fas fa-chevron-right"></i>
        </button>
      </div>
    </div>
  </div>

  <!-- Add Employee Modal -->
  <div *ngIf="showAddEmployeeModal" class="modal-overlay" (click)="closeModal($event)">
    <div class="modal-dialog" (click)="$event.stopPropagation()">
      <div class="modal-content">
        <div class="modal-header">
          <h5>Add New Employee</h5>
          <button class="btn-close" (click)="showAddEmployeeModal = false">
            <i class="fas fa-times"></i>
          </button>
        </div>
        <div class="modal-body">
          <form [formGroup]="employeeForm" (ngSubmit)="addEmployee()">
            <div class="row">
              <div class="col-md-6 mb-3">
                <label class="form-label">Employee ID *</label>
                <input type="text" formControlName="employeeId" class="form-control" placeholder="Auto-generated"
                  readonly>
              </div>
              <div class="col-md-6 mb-3">
                <label class="form-label">Email *</label>
                <input type="email" formControlName="email" class="form-control" placeholder="john@company.com">
              </div>
            </div>
            <div class="row">
              <div class="col-md-6 mb-3">
                <label class="form-label">First Name *</label>
                <input type="text" formControlName="firstName" class="form-control" placeholder="John"
                  (input)="generateEmployeeId()">
              </div>
              <div class="col-md-6 mb-3">
                <label class="form-label">Last Name *</label>
                <input type="text" formControlName="lastName" class="form-control" placeholder="Doe"
                  (input)="generateEmployeeId()">
              </div>
            </div>
            <div class="row">
              <div class="col-md-6 mb-3">
                <label class="form-label">Phone Number *</label>
                <input type="tel" formControlName="phoneNumber" class="form-control" placeholder="+1234567890">
              </div>
              <div class="col-md-6 mb-3">
                <label class="form-label">Title</label>
                <input type="text" formControlName="title" class="form-control" placeholder="Software Engineer">
              </div>
            </div>
            <div class="row">
              <div class="col-md-6 mb-3">
                <label class="form-label">Department</label>
                <select formControlName="departmentId" class="form-select">
                  <option value="">Select Department</option>
                  <option *ngFor="let dept of departments" [value]="dept.DepartmentId">{{dept.DepartmentName}}</option>
                </select>
              </div>
              <div class="col-md-6 mb-3">
                <label class="form-label">Location</label>
                <select formControlName="locationId" class="form-select">
                  <option value="">Select Location</option>
                  <option *ngFor="let loc of locations" [value]="loc.LocationId">{{loc.Name}}</option>
                </select>
              </div>
            </div>
            <div class="row">
              <div class="col-md-6 mb-3">
                <label class="form-label">Password *</label>
                <input type="password" formControlName="password" class="form-control" placeholder="Password">
              </div>
              <div class="col-md-6 mb-3">
                <label class="form-label">Confirm Password *</label>
                <input type="password" formControlName="confirmPassword" class="form-control"
                  placeholder="Confirm Password">
              </div>
            </div>
            <div class="modal-actions">
              <button type="button" class="btn-secondary" (click)="showAddEmployeeModal = false">Cancel</button>
              <button type="submit" class="btn-primary" [disabled]="employeeForm.invalid || saving">{{saving ?
                'Adding...' : 'Add Employee'}}</button>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>
</div>